<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Haikyuu Volleyball Lineup Builder</title>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', Arial, sans-serif;
      background: #ffe066;
    }
    .container {
      max-width: 980px;
      margin: 30px auto;
      background: #f7fbff;
      border-radius: 20px;
      box-shadow: 0 4px 32px #aac4e3;
      padding: 20px 30px 40px 30px;
      position: relative;
    }
    h1 { text-align: center; }
    #upload-list { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-bottom: 10px;}
    .upload-thumb {
      width: 65px; height: 85px; object-fit: cover;
      border: 2px solid #1976d2; border-radius: 7px; margin: 2px; cursor: grab;
      background: #fff; box-shadow: 0 1px 4px #aac4e3;
      transition: box-shadow 0.17s, border-color 0.17s;
    }
    .upload-thumb.selected {
      box-shadow: 0 0 0 4px #ffd700;
      border-color: #f9a602;
    }
    .drop-slot {
      display: inline-block;
      width: 110px; height: 143px;
      background: rgba(255,255,255,0.8);
      border: 2.5px dashed #1976d2;
      border-radius: 14px;
      margin: 10px;
      position: relative;
      vertical-align: top;
      cursor: pointer;
      text-align: center;
      transition: background 0.17s;
    }
    .drop-slot.dragover { background: #fff7b2; border-color: #f9a602; }
    .char-img {
      max-width: 98px; max-height: 120px;
      border-radius: 9px;
      background: #fff;
      border: 1.5px solid #b2cbe9;
      box-shadow: 0 2px 8px #aac4e3;
      cursor: grab;
    }
    /* --- Add modal styles --- */
    .modal-bg {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.22);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .modal-bg.active { display: flex; }
    .modal-content {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 8px 40px #aac4e3;
      padding: 30px 26px 18px 26px;
      min-width: 330px;
      max-width: 92vw;
      max-height: 90vh;
      overflow-y: auto;
      text-align: center;
      position: relative;
    }
    .modal-title {
      font-size: 1.35em;
      font-weight: 700;
      color: #1976d2;
      margin-bottom: 12px;
    }
    .modal-close {
      position: absolute;
      top: 8px; right: 16px;
      background: none;
      border: none;
      color: #db3a3a;
      font-size: 1.7em;
      cursor: pointer;
      font-weight: bold;
    }
    .modal-img-list {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin-top: 10px;
      margin-bottom: 10px;
    }
    .modal-thumb {
      width: 75px; height: 99px; object-fit: cover;
      border: 2px solid #1976d2;
      border-radius: 7px;
      margin: 2px;
      cursor: pointer;
      background: #fff;
      box-shadow: 0 1px 4px #aac4e3;
      transition: box-shadow 0.17s, border-color 0.17s;
    }
    .modal-thumb:hover {
      box-shadow: 0 0 0 5px #ffd700;
      border-color: #f9a602;
      z-index: 2;
    }
    .modal-thumb.selected {
      box-shadow: 0 0 0 4px #ffd700;
      border-color: #f9a602;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Haikyuu Volleyball Lineup Builder</h1>
  <input type="file" id="img-upload" accept="image/*" multiple style="display: none"/>
  <button onclick="document.getElementById('img-upload').click()">Upload Character</button>
  <div id="upload-list"></div>
  <!-- Example lineup slots -->
  <div id="lineup">
    <div class="drop-slot" data-slot="0"></div>
    <div class="drop-slot" data-slot="1"></div>
    <div class="drop-slot" data-slot="2"></div>
    <div class="drop-slot" data-slot="3"></div>
    <div class="drop-slot" data-slot="4"></div>
    <div class="drop-slot" data-slot="5"></div>
  </div>
</div>
<!-- Modal for selecting images from httd files -->
<div class="modal-bg" id="img-modal">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal()">&times;</button>
    <div class="modal-title">Select Character Image</div>
    <div id="modal-img-list" class="modal-img-list"></div>
  </div>
</div>
<script>
let uploadedImages = [];
let currentDragIndex = null;
let selectedUploadIndex = null;
let slotImages = {};

// ---- Load remote images from httd folder ----
let httdImages = [];
const httdFilesApi = 'https://api.github.com/repos/DeBuDDi/debuddi.github.io/contents/httd';

function fetchHttdImages() {
  fetch(httdFilesApi)
    .then(r => r.json())
    .then(list => {
      httdImages = Array.isArray(list) ? list
        .filter(item => item.type === 'file' && /\.(png|jpg|jpeg|gif|webp)$/i.test(item.name))
        .map(item => item.download_url) : [];
      if (document.getElementById('img-modal').classList.contains('active'))
        renderModalImages();
    });
}
fetchHttdImages();

document.getElementById('img-upload').addEventListener('change', function(e) {
  for (let file of e.target.files) {
    let reader = new FileReader();
    reader.onload = function(evt) {
      uploadedImages.push(evt.target.result);
      renderUploaded();
    };
    reader.readAsDataURL(file);
  }
});

function renderUploaded() {
  const list = document.getElementById('upload-list');
  list.innerHTML = '';
  uploadedImages.forEach((src, i) => {
    let img = document.createElement('img');
    img.src = src;
    img.className = 'upload-thumb' + (selectedUploadIndex === i ? ' selected' : '');
    img.draggable = true;
    img.ondragstart = () => currentDragIndex = i;
    img.title = 'Drag to lineup';

    img.addEventListener('click', function(e) {
      if (selectedUploadIndex === i) {
        selectedUploadIndex = null;
      } else {
        selectedUploadIndex = i;
      }
      renderUploaded();
    });
    list.appendChild(img);
  });
}

function setSlotImage(slot, imgSrc) {
  const slotKey = slot.dataset.slot;
  slot.innerHTML = '';
  slotImages[slotKey] = imgSrc;
  let img = document.createElement('img');
  img.src = imgSrc;
  img.className = 'char-img';
  img.draggable = true;
  img.ondragstart = function(e) {
    window._draggingSlot = slot;
    currentDragIndex = null;
    e.dataTransfer.setData('text/plain', '');
  };
  slot.appendChild(img);
}

function clearSlot(slot) {
  const slotKey = slot.dataset.slot;
  slot.innerHTML = '';
  slotImages[slotKey] = null;
}

function renderSlot(slot) {
  const slotKey = slot.dataset.slot;
  slot.innerHTML = '';
  if(slotImages[slotKey]) {
    setSlotImage(slot, slotImages[slotKey]);
  }
}

function openModal(slot) {
  document.getElementById('img-modal').classList.add('active');
  document.body.style.overflow = 'hidden';
  window._modalSlot = slot;
  renderModalImages();
}
function closeModal() {
  document.getElementById('img-modal').classList.remove('active');
  document.body.style.overflow = '';
  window._modalSlot = null;
}
function renderModalImages() {
  const modalList = document.getElementById('modal-img-list');
  modalList.innerHTML = '';
  httdImages.forEach((src, idx) => {
    let img = document.createElement('img');
    img.src = src;
    img.className = 'modal-thumb';
    img.title = src.split('/').pop();
    img.onclick = () => {
      if (window._modalSlot) {
        setSlotImage(window._modalSlot, src);
        closeModal();
      }
    };
    modalList.appendChild(img);
  });
  if (httdImages.length === 0) {
    modalList.innerHTML = '<div style="color:#888;padding:10px;">No images found in <b>httd</b> folder.</div>';
  }
}

// --- Drag & Drop and click handlers ---
document.querySelectorAll('.drop-slot').forEach(slot => {
  slot.ondragover = e => { e.preventDefault(); slot.classList.add('dragover'); };
  slot.ondragleave = () => slot.classList.remove('dragover');
  slot.ondrop = function(e) {
    e.preventDefault(); slot.classList.remove('dragover');
    if (currentDragIndex !== null && uploadedImages[currentDragIndex]) {
      setSlotImage(slot, uploadedImages[currentDragIndex]);
    }
    else if (window._draggingSlot && window._draggingSlot !== slot) {
      setSlotImage(slot, slotImages[window._draggingSlot.dataset.slot]);
      clearSlot(window._draggingSlot);
    }
    currentDragIndex = null;
    window._draggingSlot = null;
    selectedUploadIndex = null;
    renderUploaded();
  };

  slot.addEventListener('mousedown', function(e) {
    if(e.target.classList.contains('char-img')) {
      window._draggingSlot = slot;
    }
  });

  slot.addEventListener('click', function(e) {
    if(selectedUploadIndex !== null && uploadedImages[selectedUploadIndex]) {
      setSlotImage(slot, uploadedImages[selectedUploadIndex]);
      selectedUploadIndex = null;
      renderUploaded();
      return;
    }
    openModal(slot);
  });

  renderSlot(slot);
});

// initialize uploads on load
renderUploaded();
</script>
</body>
</html>
